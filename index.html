<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldEdit Elite</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background: #0d0d1a; color: #fff; height: 100vh; overflow: hidden; }
        .container { height: 100vh; display: flex; flex-direction: column; }
        .media-container { flex: 1; display: flex; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.9); position: relative; }
        canvas, video { max-width: 100%; max-height: 100%; object-fit: contain; }
        .navbar { position: fixed; bottom: 0; width: 100%; background: rgba(20, 20, 40, 0.95); padding: 15px; display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 10px; box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.5); }
        .tool-btn { padding: 10px 20px; background: #2a2a5a; border: none; color: #fff; border-radius: 25px; cursor: pointer; font-size: 14px; transition: all 0.2s ease; white-space: nowrap; }
        .tool-btn:hover { background: #00ccff; color: #0d0d1a; }
        .controls { position: absolute; top: 15px; right: 15px; display: flex; gap: 10px; }
        .controls button, .controls select { padding: 10px; background: #2a2a5a; border: none; color: #fff; border-radius: 5px; cursor: pointer; }
        .controls button:hover { background: #ff0066; }
        input[type="file"] { position: absolute; top: 15px; left: 15px; padding: 10px; background: #2a2a5a; border-radius: 5px; color: #fff; }
        .slider { display: none; position: absolute; bottom: 70px; left: 50%; transform: translateX(-50%); background: rgba(20, 20, 40, 0.9); padding: 10px; border-radius: 10px; width: 300px; text-align: center; }
        .slider input[type="range"] { width: 100%; }
        .text-overlay { position: absolute; cursor: move; padding: 5px; background: rgba(0, 0, 0, 0.5); border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="media-container">
            <input type="file" id="mediaUpload" accept="image/*,video/*">
            <canvas id="canvas" style="display: none;"></canvas>
            <video id="video" controls style="display: none;"></video>
            <div class="controls">
                <button onclick="saveMedia()">Save</button>
                <select id="saveFormat">
                    <option value="png">PNG</option>
                    <option value="jpg">JPG</option>
                    <option value="jpeg">JPEG</option>
                    <option value="pdf">PDF</option>
                    <option value="mp4">MP4</option>
                </select>
                <button onclick="undo()">Undo</button>
                <button onclick="redo()">Redo</button>
                <button onclick="reset()">Reset</button>
            </div>
            <div class="slider" id="slider"><input type="range" min="0" max="200" value="100" id="range" oninput="applySlider(this.dataset.tool, this.value)"></div>
        </div>
        <div class="navbar">
            <!-- Image Tools -->
            <button class="tool-btn" onclick="applyFilter('grayscale')">Grayscale</button>
            <button class="tool-btn" onclick="applyFilter('sepia')">Sepia</button>
            <button class="tool-btn" onclick="applyFilter('blur')">Blur</button>
            <button class="tool-btn" onclick="applyFilter('contrast')">Contrast</button>
            <button class="tool-btn" onclick="applyFilter('invert')">Invert</button>
            <button class="tool-btn" onclick="applyFilter('saturate')">Saturate</button>
            <button class="tool-btn" onclick="showSlider('brightness')">Brightness</button>
            <button class="tool-btn" onclick="showSlider('darkness')">Darkness</button>
            <button class="tool-btn" onclick="rotate(90)">Rotate 90°</button>
            <button class="tool-btn" onclick="rotate(-90)">Rotate -90°</button>
            <button class="tool-btn" onclick="flip('horizontal')">Flip H</button>
            <button class="tool-btn" onclick="flip('vertical')">Flip V</button>
            <button class="tool-btn" onclick="showSlider('crop')">Crop</button>
            <button class="tool-btn" onclick="addText()">Add Text</button>
            <button class="tool-btn" onclick="showSlider('resize')">Resize</button>
            <button class="tool-btn" onclick="applyFilter('hue-rotate')">Hue Rotate</button>
            <button class="tool-btn" onclick="sharpen()">Sharpen</button>
            <button class="tool-btn" onclick="addBorder()">Border</button>
            <button class="tool-btn" onclick="showSlider('opacity')">Opacity</button>
            <button class="tool-btn" onclick="vignette()">Vignette</button>
            <button class="tool-btn" onclick="posterize()">Posterize</button>
            <button class="tool-btn" onclick="noise()">Noise</button>
            <button class="tool-btn" onclick="pixelate()">Pixelate</button>
            <button class="tool-btn" onclick="emboss()">Emboss</button>
            <button class="tool-btn" onclick="solarize()">Solarize</button>
            <button class="tool-btn" onclick="tiltShift()">Tilt Shift</button>
            <button class="tool-btn" onclick="lensFlare()">Lens Flare</button>
            <button class="tool-btn" onclick="vintage()">Vintage</button>
            <button class="tool-btn" onclick="cartoon()">Cartoon</button>
            <button class="tool-btn" onclick="oilPaint()">Oil Paint</button>
            <button class="tool-btn" onclick="watercolor()">Watercolor</button>
            <button class="tool-btn" onclick="sketch()">Sketch</button>
            <button class="tool-btn" onclick="glow()">Glow</button>
            <button class="tool-btn" onclick="desaturate()">Desaturate</button>
            <button class="tool-btn" onclick="edgeDetect()">Edge Detect</button>
            <!-- Video Tools -->
            <button class="tool-btn" onclick="applyVideoFilter('grayscale')">V-Grayscale</button>
            <button class="tool-btn" onclick="applyVideoFilter('sepia')">V-Sepia</button>
            <button class="tool-btn" onclick="applyVideoFilter('blur')">V-Blur</button>
            <button class="tool-btn" onclick="showSlider('trim')">Trim</button>
            <button class="tool-btn" onclick="showSlider('speed')">Speed</button>
            <button class="tool-btn" onclick="muteVideo()">Mute</button>
            <button class="tool-btn" onclick="rotateVideo(90)">V-Rotate 90°</button>
            <button class="tool-btn" onclick="showSlider('cropVideo')">V-Crop</button>
            <button class="tool-btn" onclick="addOverlay()">V-Overlay</button>
            <button class="tool-btn" onclick="showSlider('volume')">Volume</button>
            <button class="tool-btn" onclick="loopVideo()">Loop</button>
            <button class="tool-btn" onclick="reverseVideo()">Reverse</button>
            <button class="tool-btn" onclick="applyVideoFilter('contrast')">V-Contrast</button>
            <button class="tool-btn" onclick="showSlider('vBrightness')">V-Brightness</button>
            <button class="tool-btn" onclick="fadeIn()">Fade In</button>
            <button class="tool-btn" onclick="fadeOut()">Fade Out</button>
            <button class="tool-btn" onclick="splitVideo()">Split</button>
            <button class="tool-btn" onclick="stabilize()">Stabilize</button>
            <button class="tool-btn" onclick="denoise()">Denoise</button>
            <button class="tool-btn" onclick="colorGrade()">Color Grade</button>
            <button class="tool-btn" onclick="slowMo()">Slow Mo</button>
            <button class="tool-btn" onclick="timeLapse()">Time Lapse</button>
            <button class="tool-btn" onclick="zoomIn()">Zoom In</button>
            <button class="tool-btn" onclick="zoomOut()">Zoom Out</button>
            <button class="tool-btn" onclick="panLeft()">Pan Left</button>
            <button class="tool-btn" onclick="panRight()">Pan Right</button>
            <button class="tool-btn" onclick="vignetteVideo()">V-Vignette</button>
            <button class="tool-btn" onclick="retroVideo()">V-Retro</button>
            <button class="tool-btn" onclick="cinematic()">Cinematic</button>
            <button class="tool-btn" onclick="greenScreen()">Green Screen</button>
            <button class="tool-btn" onclick="stabilizeAudio()">Stabilize Audio</button>
            <button class="tool-btn" onclick="echo()">Echo</button>
            <button class="tool-btn" onclick="pitchShift()">Pitch Shift</button>
            <button class="tool-btn" onclick="reverb()">Reverb</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas'), video = document.getElementById('video'), ctx = canvas.getContext('2d');
        let mediaType = null, img = new Image(), history = [], currentStep = -1, textOverlays = [];

        window.onload = () => { const saved = localStorage.getItem('editorState'); if (saved) loadState(JSON.parse(saved)); };

        document.getElementById('mediaUpload').addEventListener('change', (e) => {
            const file = e.target.files[0], url = URL.createObjectURL(file);
            if (file.type.startsWith('image')) {
                mediaType = 'image'; img.src = url; img.onload = () => {
                    canvas.width = img.width; canvas.height = img.height; ctx.drawImage(img, 0, 0);
                    canvas.style.display = 'block'; video.style.display = 'none'; saveState();
                };
            } else if (file.type.startsWith('video')) {
                mediaType = 'video'; video.src = url; video.style.display = 'block'; canvas.style.display = 'none'; saveState();
            }
        });

        // Slider Handling
        function showSlider(tool) {
            const slider = document.getElementById('slider'), range = document.getElementById('range');
            slider.style.display = 'block'; range.dataset.tool = tool;
            range.min = tool === 'trim' ? -30 : tool === 'speed' || tool === 'volume' || tool === 'vBrightness' ? 0 : 0;
            range.max = tool === 'trim' ? 30 : tool === 'speed' || tool === 'volume' || tool === 'vBrightness' ? 200 : 200;
            range.value = tool === 'speed' || tool === 'volume' ? 100 : tool === 'trim' ? 0 : 100;
            setTimeout(() => slider.style.display = 'none', 5000); // Auto-hide after 5s
        }

        function applySlider(tool, value) {
            if (mediaType === 'image') {
                if (tool === 'brightness') { ctx.filter = `brightness(${value}%)`; ctx.drawImage(img, 0, 0); saveState(); }
                if (tool === 'darkness') { ctx.filter = `brightness(${200 - value}%)`; ctx.drawImage(img, 0, 0); saveState(); }
                if (tool === 'crop') { const scale = value / 100; canvas.width = img.width * scale; canvas.height = img.height * scale; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); saveState(); }
                if (tool === 'resize') { const scale = value / 100; canvas.width = img.width * scale; canvas.height = img.height * scale; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); saveState(); }
                if (tool === 'opacity') { ctx.globalAlpha = value / 100; ctx.drawImage(img, 0, 0); ctx.globalAlpha = 1; saveState(); }
            } else if (mediaType === 'video') {
                if (tool === 'trim') { video.currentTime += value / 10; saveState(); }
                if (tool === 'speed') { video.playbackRate = value / 100; saveState(); }
                if (tool === 'volume') { video.volume = value / 200; saveState(); }
                if (tool === 'cropVideo') { const scale = value / 100; video.style.width = `${video.videoWidth * scale}px`; video.style.height = `${video.videoHeight * scale}px`; saveState(); }
                if (tool === 'vBrightness') { video.style.filter = `brightness(${value}%)`; saveState(); }
            }
        }

        // Image Tools
        function applyFilter(filter) { if (mediaType === 'image') { ctx.filter = `${filter}(100%)`; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function rotate(deg) { if (mediaType === 'image') { ctx.save(); ctx.translate(canvas.width / 2, canvas.height / 2); ctx.rotate(deg * Math.PI / 180); ctx.translate(-canvas.width / 2, -canvas.height / 2); ctx.drawImage(img, 0, 0); redrawText(); ctx.restore(); saveState(); } }
        function flip(direction) { if (mediaType === 'image') { ctx.save(); ctx.scale(direction === 'horizontal' ? -1 : 1, direction === 'vertical' ? -1 : 1); ctx.drawImage(img, direction === 'horizontal' ? -canvas.width : 0, direction === 'vertical' ? -canvas.height : 0); redrawText(); ctx.restore(); saveState(); } }
        function addText() {
            if (mediaType !== 'image') return;
            const text = prompt('Enter text:') || 'Text';
            const overlay = { text, x: 50, y: 50 };
            textOverlays.push(overlay);
            redrawCanvas();
            makeTextDraggable(overlay);
            saveState();
        }
        function redrawCanvas() { ctx.drawImage(img, 0, 0); redrawText(); }
        function redrawText() { textOverlays.forEach(o => { ctx.font = '30px Arial'; ctx.fillStyle = '#fff'; ctx.fillText(o.text, o.x, o.y); }); }
        function makeTextDraggable(overlay) {
            const div = document.createElement('div');
            div.className = 'text-overlay'; div.textContent = overlay.text;
            div.style.left = `${overlay.x}px`; div.style.top = `${overlay.y - 30}px`;
            document.querySelector('.media-container').appendChild(div);
            let isDragging = false, startX, startY;
            div.onmousedown = (e) => { isDragging = true; startX = e.clientX - overlay.x; startY = e.clientY - overlay.y; };
            document.onmousemove = (e) => { if (isDragging) { overlay.x = e.clientX - startX; overlay.y = e.clientY - startY; div.style.left = `${overlay.x}px`; div.style.top = `${overlay.y - 30}px`; redrawCanvas(); } };
            document.onmouseup = () => { isDragging = false; saveState(); };
        }
        function sharpen() { if (mediaType === 'image') { ctx.filter = 'contrast(150%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function addBorder() { if (mediaType === 'image') { ctx.strokeStyle = '#fff'; ctx.lineWidth = 5; ctx.strokeRect(0, 0, canvas.width, canvas.height); redrawText(); saveState(); } }
        function vignette() { if (mediaType === 'image') { ctx.filter = 'brightness(50%) contrast(120%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function posterize() { if (mediaType === 'image') { ctx.filter = 'contrast(200%) brightness(80%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function noise() { if (mediaType === 'image') { ctx.filter = 'contrast(110%) brightness(90%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function pixelate() { if (mediaType === 'image') { ctx.imageSmoothingEnabled = false; ctx.drawImage(img, 0, 0, canvas.width / 10, canvas.height / 10); ctx.drawImage(canvas, 0, 0, canvas.width / 10, canvas.height / 10, 0, 0, canvas.width, canvas.height); redrawText(); saveState(); } }
        function emboss() { if (mediaType === 'image') { ctx.filter = 'contrast(150%) brightness(50%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function solarize() { if (mediaType === 'image') { ctx.filter = 'invert(50%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function tiltShift() { if (mediaType === 'image') { ctx.filter = 'blur(2px) contrast(120%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function lensFlare() { if (mediaType === 'image') { ctx.filter = 'brightness(120%) contrast(110%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function vintage() { if (mediaType === 'image') { ctx.filter = 'sepia(50%) contrast(90%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function cartoon() { if (mediaType === 'image') { ctx.filter = 'contrast(150%) saturate(200%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function oilPaint() { if (mediaType === 'image') { ctx.filter = 'blur(1px) contrast(130%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function watercolor() { if (mediaType === 'image') { ctx.filter = 'blur(2px) saturate(150%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function sketch() { if (mediaType === 'image') { ctx.filter = 'grayscale(100%) contrast(150%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function glow() { if (mediaType === 'image') { ctx.filter = 'brightness(120%) blur(1px)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function desaturate() { if (mediaType === 'image') { ctx.filter = 'saturate(0%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }
        function edgeDetect() { if (mediaType === 'image') { ctx.filter = 'contrast(200%) brightness(50%)'; ctx.drawImage(img, 0, 0); redrawText(); saveState(); } }

        // Video Tools
        function applyVideoFilter(filter) { if (mediaType === 'video') { video.style.filter = `${filter}(100%)`; saveState(); } }
        function muteVideo() { if (mediaType === 'video') { video.muted = !video.muted; saveState(); } }
        function rotateVideo(deg) { if (mediaType === 'video') { video.style.transform = `rotate(${deg}deg)`; saveState(); } }
        function addOverlay() { if (mediaType === 'video') { video.style.opacity = '0.8'; saveState(); } }
        function loopVideo() { if (mediaType === 'video') { video.loop = !video.loop; saveState(); } }
        function reverseVideo() { if (mediaType === 'video') { video.playbackRate = -1; saveState(); } }
        function fadeIn() { if (mediaType === 'video') { video.style.transition = 'opacity 1s'; video.style.opacity = 1; saveState(); } }
        function fadeOut() { if (mediaType === 'video') { video.style.transition = 'opacity 1s'; video.style.opacity = 0.5; saveState(); } }
        function splitVideo() { if (mediaType === 'video') { video.pause(); saveState(); } }
        function stabilize() { if (mediaType === 'video') { video.style.transform = 'scale(1.05)'; saveState(); } }
        function denoise() { if (mediaType === 'video') { video.style.filter = 'contrast(110%)'; saveState(); } }
        function colorGrade() { if (mediaType === 'video') { video.style.filter = 'saturate(120%)'; saveState(); } }
        function slowMo() { if (mediaType === 'video') { video.playbackRate = 0.25; saveState(); } }
        function timeLapse() { if (mediaType === 'video') { video.playbackRate = 4; saveState(); } }
        function zoomIn() { if (mediaType === 'video') { video.style.transform = 'scale(1.2)'; saveState(); } }
        function zoomOut() { if (mediaType === 'video') { video.style.transform = 'scale(0.8)'; saveState(); } }
        function panLeft() { if (mediaType === 'video') { video.style.transform = 'translateX(-50px)'; saveState(); } }
        function panRight() { if (mediaType === 'video') { video.style.transform = 'translateX(50px)'; saveState(); } }
        function vignetteVideo() { if (mediaType === 'video') { video.style.filter = 'brightness(50%) contrast(120%)'; saveState(); } }
        function retroVideo() { if (mediaType === 'video') { video.style.filter = 'sepia(50%)'; saveState(); } }
        function cinematic() { if (mediaType === 'video') { video.style.filter = 'contrast(130%) brightness(90%)'; saveState(); } }
        function greenScreen() { if (mediaType === 'video') { video.style.filter = 'hue-rotate(90deg)'; saveState(); } }
        function stabilizeAudio() { if (mediaType === 'video') { video.volume = 0.8; saveState(); } }
        function echo() { if (mediaType === 'video') { video.volume = 0.6; saveState(); } }
        
        function saveMedia() {
            const format = document.getElementById('saveFormat').value;
            if (mediaType === 'image') { const link = document.createElement('a'); link.download = `elite.${format}`; link.href = canvas.toDataURL(`image/${format}`); link.click(); }
            else alert('Video saving requires manual download.');
        }

        function saveState() { if (mediaType === 'image') { history = history.slice(0, currentStep + 1); history.push(canvas.toDataURL()); currentStep++; } localStorage.setItem('editorState', JSON.stringify({ history, currentStep, mediaType })); }
        function loadState(state) { history = state.history; currentStep = state.currentStep; mediaType = state.mediaType; if (mediaType === 'image' && history.length) { const imgState = new Image(); imgState.src = history[currentStep]; imgState.onload = () => { canvas.width = imgState.width; canvas.height = imgState.height; ctx.drawImage(imgState, 0, 0); canvas.style.display = 'block'; }; } }
        function undo() { if (currentStep > 0) { currentStep--; const imgState = new Image(); imgState.src = history[currentStep]; imgState.onload = () => ctx.drawImage(imgState, 0, 0); } }
        function redo() { if (currentStep < history.length - 1) { currentStep++; const imgState = new Image(); imgState.src = history[currentStep]; imgState.onload = () => ctx.drawImage(imgState, 0, 0); } }
        function reset() { if (mediaType === 'image') { ctx.filter = 'none'; ctx.drawImage(img, 0, 0); saveState(); } else { video.style.filter = 'none'; video.style.transform = 'none'; video.playbackRate = 1; video.muted = false; saveState(); } }
    </script>
</body>
</html>
